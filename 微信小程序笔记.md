# 微信小程序

![首图](https://i2.hdslb.com/bfs/archive/d60200db9a0c7b25f35a1eacc2ccb609e8b69a83.jpg)

## 小程序简介

### 1.小程序与普通网页开发的区别

![小程序与普通网页开发的区别](./images/小程序与普通网页开发的区别.png)

### 2.体验微信小程序

<img src="./images/体验微信小程序.png" alt="体验微信小程序" style="zoom:50%;" />



## 第一个小程序

### 1.注册开发账号

在[微信公众平台](https://mp.weixin.qq.com/)中注册开发账号

①

![注册开发账号Step1](./images/注册开发账号Step1.png)

②

![注册开发账号Step2](./images/注册开发账号Step2.png)

③

![注册开发账号Step3](./images/注册开发账号Step3.png)



### 2.获取小程序的AppID

![获取AppID](./images/获取AppID.png)



### 3.安装开发者工具

<span style="color:red;">微信开发者工具</span>是官方推荐使用的小程序开发工具，它提供的主要功能如下：

1.快速创建小程序项目

2.代码的查看和编辑

3.对小程序功能进行调试

4.小程序的预览和发布

[安装包下载](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)



### 4.创建小程序项目

![主界面](./images/主界面.png)



### 5.项目结构

![项目结构](./images/项目结构.png)

<span style="color:red;">①**pages** 用来存放所有小程序的页面</span>

②**utils** 用来存放工具性质的模块

<span style="color:red;">③**app.js** 小程序项目的入口文件</span>

<span style="color:red;">④**app.json** 小程序的全局配置文件</span>

⑤**app.wxss** 小程序的全局样式文件

⑥**project.config.json** 项目的配置文件

⑦**sitemap.json** 用来配置小程序及其页面是否允许被微信索引



### 6.小程序页面的组成部分

小程序官方建议把所有小程序的页面，都存放在<span style="color:red;">**pages目录**</span>中，以<span style="color:red;">单独的文件夹</span>存在，如图

![小程序的页面组成](./images/小程序的页面组成.png)

其中，每个页面<span style="color:red;">由4个基本文件</span>组成：

①<span style="color:red;">.js</span>文件：页面的脚步文件，存放页面的数据、事件处理函数等

②<span style="color:red;">.json</span>文件：当前页面的配置文件，配置窗口的外观、表现等

③<span style="color:red;">.wxml</span>文件：页面的模板结构文件

④<span style="color:red;">.wxss</span>文件：当前页面的样式表文件



### 7.JSON配置文件

![JSON配置文件](./images/JSON配置文件.png)

小程序项目中有4中json配置文件，分别是：

①项目根目录中的 <span style="color:red;">app.json</span> 配置文件

②项目根目录中的 <span style="color:red;">project.config.json</span> 配置文件

③项目根目录中的 sitemap.json 配置文件

④<span style="color:red;">**每个页面文件夹中的 .json  配置文件** </span>



==app.json 文件==

app.json是当前小程序的<span style="color:red;">**全局配置**</span>，包括了小程序的

- 所有页面路径
- 窗口外观
- 界面表现
- 底部tab

等等

![app.json配置项](./images/app.json配置项.png)



==project.config.json 文件==

project.config.json是项目配置文件，用来记录我们<span style="color:red;">对小程序开发工具所做的个性化设置</span>，例如：

- <span style="color:red;">setting</span> 中保存了 <span style="color:red;">编译相关的配置</span>
- <span style="color:red;">projectname</span> 中保存的是 <span style="color:red;">项目名称</span>
- <span style="color:red;">appid</span> 中保存的是 <span style="color:red;">小程序的账号ID</span>



==sitemap.json 文件==

微信现已开放<span style="color:red;">小程序内搜索</span>，效果类似于PC网页的SEO。

sitemap.json 文件用来<span style="color:red;">配置小程序页面是否允许微信索引</span>。

> 当开发者允许微信索引时，微信会通过爬虫的形式，为小程序的页面内容建立索引。
>
> 当用户的搜索关键字和页面的索引匹配成功时，小程序的页面将可能展示在搜索结果中。

![sitemap.json文件作用](./images/sitemap.json文件作用.png)



==页面的 .json 配置文件==

小程序中的每一个页面，可以使用 .json 文件来<span style="color:red;">对本页面的窗口外观进行配置</span>，<span style="color:red;">**页面中的配置项会覆盖 app.json 的 window 中相同的配置项**</span>

例如：将首页的导航栏背景色改为绿色

![配置首页导航栏背景色](./images/配置首页导航栏背景色.png)



### 8.新建小程序页面

只需要在 <span style="color:red;">app.json</span> ==> <span style="color:red;">pages</span> 中新增页面的存放路径，开发工具即可帮我们自动创建对应的页面文件

![新建小程序页面](./images/新建小程序页面.png)



### 9.修改项目首页

只需要调整 <span style="color:red;">app.json</span> ==> <span style="color:red;">pages</span> 数组中页面路径的前后顺序，即可修改项目的首页。

小程序会把排在第一位的页面，当做项目首页进行渲染。



## WXML模板

### 1.什么是WXML？

​	WeiXin Markup Language 是小程序框架设计的一套<span style="color:red;">标签语言</span>，<span style="color:red;">用来构建小程序页面的结构</span>，其作用类似于HTML。



### 2.WXML 和 HTML 的区别

①<span style="color:red;">标签名称不同</span>

- HTML （div, span, img, a）
- WXML（view, text, image, navigator）

②<span style="color:red;">属性节点不同</span>

- \<a **href**="#">超链接\</a>
- \<navigator **url**="/pages/home/home">\</navigator>

③<span style="color:red;">提供了类似于Vue中的模板语法</span>

- 数据绑定
- 列表渲染
- 条件渲染



## WXSS样式

### 1.什么是WXSS

WeiXin Style Sheet 是一套样式语言，用于描述WXML的组件样式，类似于CSS。



### 2.WXSS 和 CSS 的区别

①<span style="color:red;">新增了rpx尺寸单位</span>

- CSS中需要手动进行像素单位换算，例如 rem
- WXSS在底层支持新的尺寸单位 rpx，在不同大小的屏幕上小程序会自动进行换算

②<span style="color:red;">提供了全局的样式和局部的样式</span>

- 项目根目录中的 app.wxss 会作用于所有小程序页面
- 局部页面的 .wxss 样式仅对当前页面生效

③<span style="color:red;">WXSS仅支持部分CSS选择器</span>

- .class 和 #id
- element
- 并集选择器、后代选择器
- ::after 和 ::before 等伪类选择器



## JS逻辑交互

一个项目仅仅提供界面展示是不够的，在小程序中，我们通过 .js 文件来处理用户的操作。

例如：响应用户的点击、获取用户的位置等等



==小程序中 .js 文件的分类==

![小程序中的js文件分类](./images/小程序中的js文件分类.png)



## 小程序的宿主环境

Host Environment 指的是<span style="color:red;">程序运行所**必须的依赖环境**</span>。例如：

Android系统 和 iOS系统 是两个不同的宿主环境。安卓版的微信App是不能在iOS环境下运行的，所以Android是安卓软件的**宿主环境**，<span style="color:red;">脱离了宿主环境的软件是没有任何意义的！</span>

![宿主环境](./images/宿主环境.png)

<span style="color:red;">**手机微信**是小程序的宿主环境</span>，如图↑

小程序借助宿主环境提供的能力，可以完成许多普通网页无法完成的功能。例如：微信扫码、微信支付、微信登录、地理定位、etc...



### 包含内容

小程序的宿主环境包含以下内容：

- 通信模型
- 运行机制
- 组件
- API



### 通信模型

小程序中通信的主体是 <span style="color:red;">渲染层</span> 和 <span style="color:red;">逻辑层</span>，其中

- WXML模板 和 WXSS样式 工作在 <span style="color:red;">渲染层</span>

- JS脚本 工作在 <span style="color:red;">逻辑层</span>

小程序中的通信模型分为两部分：

① <span style="color:red;">渲染层</span> 和 <span style="color:red;">逻辑层</span> 之间的通信，由微信客户端进行转发

② <span style="color:red;">逻辑层</span> 和 <span style="color:red;">第三方服务器</span> 之间的通信，由微信客户端进行转发

![通信模型](./images/通信模型.png)



### 运行机制

小程序的启动过程

![小程序启动的过程](./images/小程序启动的过程.png)

页面的渲染过程

![页面的渲染过程](./images/页面的渲染过程.png)



### 组件

小程序中的组件也是由宿主环境提供的。

开发者可以基于组件快速搭建出漂亮的页面结构。官方把小程序的组件分为了9大类

<span style="color:red;">1.视图容器</span>

<span style="color:red;">2.基础内容</span>

<span style="color:red;">3.表单组件</span>

<span style="color:red;">4.导航组件</span>

5.媒体组件

6.map地图组件

7.canvas画布组件

8.开放能力

9.无障碍访问



#### <span style="color:red;">1.视图容器</span>

##### view

- 普通的视图区域
- 类似于div
- 常用来实现页面的布局效果

==案例：list页面==

`list.wxml`

```xml
<!--pages/list/list.wxml-->
<view class="container1">
  <view>A</view>
  <view>B</view>
  <view>C</view>
</view>
```

`list.wxss`

```css
/* pages/list/list.wxss */
.container1 view {
  width: 100px;
  height: 100px;
  text-align: center;
  line-height: 100px;
}

.container1 view:nth-child(1) {
    background-color: lightgreen;
}

.container1 view:nth-child(2) {
    background-color: lightskyblue;
}

.container1 view:nth-child(3) {
    background-color: lightpink;
}

.container1 {
  display: flex;
  justify-content: space-around;
}
```

案例效果

![案例效果1](./images/案例效果1.png)



##### scroll-view

- 可滚动的视图区域
- 常用来实现滚动列表的效果

==案例：list页面==

`list.wxml`

```xml
<scroll-view class="container2" scroll-y>
    <view>A</view>
    <view>B</view>
    <view>C</view>
</scroll-view>
```

`list.wxss`

```css
.container2 view {
    width: 100px;
    height: 100px;
    text-align: center;
    line-height: 100px;
}

.container2 view:nth-child(1) {
    background-color: lightgreen;
}

.container2 view:nth-child(2) {
    background-color: lightskyblue;
}

.container2 view:nth-child(3) {
    background-color: lightpink;
}

.container2 {
    margin-top: 20px;
    margin-left: 14px;
    border: 1px solid red;
    /* 给 scroll-view固定高度*/
    height: 120px;
    width: 100px;
}
```

案例效果

![案例效果2](./images/案例效果2.png)



##### swiper和swiper-item

- 轮播图容器组件 和 轮播图item组件

<span style="color:red;">swiper组件的常用属性</span>

![swiper常用属性](./images/swiper常用属性.png)

==案例：list页面==

`list.wxml`

```xml
<swiper class="swiper-container" indicator-dots>
    <swiper-item>
        <view class="item">A</view>
    </swiper-item>
    <swiper-item>
        <view class="item">B</view>
    </swiper-item>
    <swiper-item>
        <view class="item">C</view>
    </swiper-item>
</swiper>
```

`list.wxss`

```css
/* 轮播图的样式 */
.swiper-container {
    margin-top: 20px;
    height: 150px;
}

.item {
    height: 100%;
    line-height: 150px;
    text-align: center;
}

swiper-item:nth-child(1) .item {
    background-color: lightgreen;
}

swiper-item:nth-child(2) .item {
    background-color: lightskyblue;
}

swiper-item:nth-child(3) .item {
    background-color: lightpink;
}
```

案例效果

![案例效果3](./images/案例效果3.png)



#### <span style="color:red;">2.基础内容</span>

##### text

- 文本组件
- 类似于span

基本使用：通过text组件的<span style="color:red;">selectable</span>属性，实现**长按选中文本内容**的效果。*其他组件均不支持此效果*

```xml
<view style="margin-top: 20px;">
    手机号支持长按选中效果：
    <text selectable>123456789</text>
</view>
```



##### rich-text

- 富文本组件
- 支持把HTML字符串渲染为WXML结构

基本使用：通过rich-text组件的nodes属性节点，<span style="color:red;">把HTML字符串渲染成对应的UI结构</span>

```xml
<rich-text style="margin-top: 20px;" nodes="<h1 style='color:red;'>标题</h1>"></rich-text>
```



#### 3.其他常用组件

##### button

- 按钮组件
- 功能比HTML中的button按钮丰富
- 通过open-type属性可以调用微信提供的各种功能（客服、转发、获取用户授权、获取用户信息等）

基本使用：通过**type**指定按钮类型、通过**size**指定按钮尺寸、通过**plain**镂空按钮

```xml
<!--pages/button/button.wxml-->
<!-- 通过type属性指定按钮颜色类型 -->
<view>===========type属性============</view>
<button>默认按钮</button>
<button type="primary">主色调按钮</button>
<button type="warn">警告按钮</button>

<!-- 通过size属性指定按钮颜色尺寸 -->
<view>============size属性============</view>
<button size="default">默认按钮</button>
<button size="mini">小尺寸按钮</button>

<!-- 通过plain属性镂空按钮 -->
<view>===========plain属性=============</view>
<button plain type="primary">镂空按钮</button>
<button plain type="warn">镂空按钮</button>
```



##### image

- 图片组件
- image组件默认宽度约为300px、高度约为240px

基本使用：

```xml
<!--pages/images/images.wxml-->
<image/>
<image src="/images/1.png" mode="aspectFit"/>
```

image组件的**mode**属性用来指定图片的**裁剪**和**缩放**模式，常用的mode属性值如下

![image组件的mode属性](./images/image组件的mode属性.png)



##### navigator

- 页面导航组件
- 类似于a链接



### API

<span style="color:red;">小程序中的API是由宿主环境提供的</span>，通过这些丰富的小程序API，开发者可以方便的调用微信提供的能力，

例如：获取用户信息、本地存储、支付功能等。

小程序的API分为3大类：

1.事件监听API

- 特点：以on开头，用来监听某些事件的触发
- 举例：wx.onWindowResize(function callback) 监听窗口尺寸变化的事件

2.同步API

- 特点1：以Sync结尾的API都是同步API
- 特点2：同步API的执行结果，可以通过函数返回值直接获取，如果执行出错会抛出异常
- 举例：wx.setStorageSync('key', 'value')向本地存储中写入内容

3.异步API

- 特点：类似于jQuery中的$.ajax(options)函数，需要通过success、fail、complete接收调用的结果
- 举例：wx.request()发起网络数据请求，通过success回调函数接收数据



## 协同工作和发布

### 1.协同工作

权限管理需求

![权限管理的需求](./images/权限管理的需求.png)

项目成员的组织结构

![项目成员的组织结构](./images/项目成员的组织结构.png)

小程序的开发流程

![小程序的开发流程](./images/小程序的开发流程.png)



### 2.小程序的成员管理

小程序的成员管理体现在<span style="color:red;">管理员</span>对小程序<span style="color:red;">项目成员</span>及<span style="color:red;">体验成员</span>的管理：

![成员管理图](./images/成员管理图.png)

项目成员

- 表示参与小程序开发、运营的成员
- 可登录小程序管理后台
- 管理员可以添加、删除项目成员，并设置项目成员的角色

体验成员

- 表示参与小程序内测体验的成员
- 可使用体验版小程序，但不属于项目成员
- 管理员及项目成员均可添加、 删除体验成员

![不同项目成员对应的权限](./images/不同项目成员对应的权限.png)

==开发者的权限说明==

①开发者权限：可使用小程序开发者工具及对小程序的功能进行代码开发

②体验者权限：可使用体验版小程序

③登录权限：可登录小程序管理后台，无需管理员确认

④开发设置：设置小程序服务器域名、消息推送及扫描普通链接二维码打开小程序

⑤腾讯云管理：云开发相关设置



==添加 项目成员 和 体验成员==

![小程序的成员管理](./images/小程序的成员管理.png)



### 3.小程序的版本

![软件开发过程中的不同版本](./images/软件开发过程中的不同版本.png)



![小程序的版本](./images/小程序的版本.png)



### 4.发布上线

一个小程序的发布上线，一般要经过<span style="color:red;">上传代码</span>-><span style="color:red;">提交审核</span>-><span style="color:red;">发布</span>这三个步骤。

1.小程序上传代码

![小程序上传代码](./images/小程序上传代码.png)



2.在后台查看上传之后的版本

![查看上传的小程序](./images/查看上传的小程序.png)



3.提交审核

![小程序提交审核](./images/小程序提交审核.png)

4.发布

![发布小程序](./images/发布小程序.png)

5.基于小程序码进行推广

![基于小程序码进行推广](./images/基于小程序码进行推广.png)



### 5.运营数据

1.查看小程序运营数据的两种方式

![查看小程序运营数据的两种方式](./images/查看小程序运营数据的两种方式.png)



## 模板与配置

### 1.WXML模板语法

#### 数据绑定

基本原则：

①在data中定义数据：在页面对应的js文件中，把数据定义到data对象中即可

②在wxml中使用数据：<span style="color:red;">Mustache语法</span>（双大括号）



Mustache语法的应用场景：

- 绑定内容
- 绑定属性
- 运算（三元运算、算术运算等）

==案例：index页面==

`index.js`

```js
// index.js
Page({
    data: {
        info: 'hello world',
        imgSrc: 'https://www.itheima.com/images/logo.png',
        randomNum1: Math.random() * 10,
        randomNum2: Math.random().toFixed(2)
    },

    onLoad() {
    },

    getUserProfile(e) {
    },

    getUserInfo(e) {
    }
})
```

`index.wxml`

```xml
<!--index.wxml-->
<!-- 动态绑定内容 -->
<view>{{info}}</view>

<!-- 动态绑定属性 -->
<image src="{{imgSrc}}" mode="widthFix"/>

<!-- 三元运算 -->
<view>{{randomNum1 >= 5 ? '5以上' : '5以下'}}</view>

<!-- 算术运算 -->
<view>{{randomNum2 * 100}}</view>
```

![数据绑定](./images/数据绑定.png)



#### 事件绑定

##### 1.什么是事件

事件是<span style="color:red;">渲染层到逻辑层的通讯方式</span>，通过事件可以将用户在渲染层产生的行为，反馈到逻辑层进行业务的处理。

![事件的定义](./images/事件的定义.png)

##### 2.小程序中常用的事件

![小程序中的常用事件](./images/小程序中的常用事件.png)

##### 3.事件对象的属性列表

当事件回调触发的时候，会收到一个事件对象event，它的详细属性如下：

![事件对象的属性列表](./images/事件对象的属性列表.png)

##### 4.target 和 currentTarget 的区别★

target 是 <span style="color:red;">触发该事件的源头组件</span>，而 currentTarget 则是 <span style="color:red;">当前事件所绑定的组件</span>。举例如下：

![target和currentTarget的区别](./images/target和currentTarget的区别.png)

点击内部的按钮时，点击事件以<span style="color:red;">冒泡</span>的方式向外扩散，也会触发外层的 view 的 tap 事件处理函数。

此时，对于外层的 view 来说：

- e.target 指向的是触发事件的源头组件，因此，e.target 是内部的按钮组件
- e.currentTarget 指向的是当前正在触发事件的那个组件，因此，e.currentTarget 是当前的 view 组件



##### 5.bind:tap 的语法格式

在小程序中，不存在HTML的onclick鼠标点击事件，而是通过 <span style="color:red;">tap</span> 事件来响应用户的触摸行为。

①通过 bind:tap，可以为组件绑定 tap 触摸事件

②在 页面.js 文件中定义对应的事件处理函数，事件参数通过形参event（一般简写成 e）来接收

==案例：index页面==

`index.js`

```js
// index.js

/* 
    页面的初始数据
*/
Page({
    data: {
        info: 'hello world',
        imgSrc: 'xxxxx',
        randomNum1: Math.random() * 10,
        randomNum2: Math.random().toFixed(2)
    },

    // 定义按钮的事件处理函数
    outerHandler(e) {
        console.log(e);
        console.log(e.target);
        console.log(e.currentTarget);
    }
})
```

`index.wxml`

```xml
<!-- target和currentTarget的区别 -->
<view class="outer-view" bind:tap="outerHandler">
    <button type="primary">按钮</button>
</view>
```



##### 6.在事件处理函数中为data中的数据赋值

通过调用 <span style="color:red;">this.setData(dataObj)</span> 方法，可以给页面 data 中的数据重新赋值

==案例：index页面==

`index.wxml`

```xml
<!-- 在事件处理函数中为data中的数据赋值 -->
<text>{{count}}</text>
<button type="primary" bind:tap="countChange">+</button>
```

`index.js`

```js
Page({
    data: {
        count: 0
    },

    // 定义按钮的事件处理函数
    countChange(e) {
        this.setData({
            //注意！此处不能用 ++，会导致按钮失效
            count: this.data.count + 1
        })
    })
```



#### 事件传参与数据同步

##### 1.事件传参

<span style="color:red;">**ERROR**：</span>

小程序中的事件传参比较特殊，<span style="color:red;">不能在绑定事件的同时为事件处理函数传递参数</span>。例如，下面的代码将不能正常工作

```xml
<button type="primary" bind:tap="btnHandler(123)">事件传参</button>
```

因为小程序会把 bind:tap 的属性值，统一当作事件名称来处理，相当于要调用一个名称为 <span style="color:red;">btnHandler(123)</span> 的事件处理函数。



<span style="color:lightgreen;">**RIGHT**：</span>

可以为组件提供 <span style="color:red;">data-*</span> 自定义属性传参，其中 <span style="color:red;">\* 代表的是参数的名字</span>，示例代码如下：

```xml
<button bind:tap="btnHandler" data-info="{{2}}">事件传参</button>
```

最终

- <span style="color:red;">info</span> 会被解析为 <span style="color:red;">参数的名字</span>
- 数值 <span style="color:red;">2</span> 会被解析为 <span style="color:red;">参数的值</span>

在事件处理函数中，通过 <span style="color:red;">event.target.dataset.参数名</span> 即可获取到 <span style="color:red;">具体参数的值</span>，示例代码如下：

```js
btnHandler(event) {
    // dataset 是一个对象，包含了所有通过 data-* 传递过来的参数项
    console.log(event.target.dataset)
    // 通过 dataset 可以访问到具体参数的值
    console.log(event.target.dataset.info)
}
```



##### 2.数据同步





### 2.WXSS模板样式



### 3.全局配置



### 4.页面配置

